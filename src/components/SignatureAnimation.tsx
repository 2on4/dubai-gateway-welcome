

import { useEffect, useRef } from "react";

export const SignatureAnimation = () => {
  

  const svgRef = useRef<SVGSVGElement | null>(null);
  const pathRef = useRef<SVGPathElement | null>(null);

  useEffect(() => {
    const svg = svgRef.current;
    const path = pathRef.current;
    if (!svg) return;

    // Respect reduced motion: reveal instantly and skip animations
    const prefersReduced = window.matchMedia?.('(prefers-reduced-motion: reduce)').matches;
    if (prefersReduced) {
      const reducedPaths = svg.querySelectorAll<SVGPathElement>('.signature-glow, .signature-medium, .signature-path');
      reducedPaths.forEach((p) => {
        p.style.animation = 'none';
        p.style.strokeDasharray = '0';
        p.style.strokeDashoffset = '0';
      });
      svg.classList.add('reveal-logo');
      document.body.classList.add('logo-revealed');
      return;
    }

    // Ensure stroke-dash metrics match real path lengths so visual end === animation end
    const paths = svg.querySelectorAll<SVGPathElement>('.signature-glow, .signature-medium, .signature-path');
    paths.forEach((p) => {
      try {
        const len = Math.ceil(p.getTotalLength());
        p.style.strokeDasharray = `${len}`;
        p.style.strokeDashoffset = `${len}`;
      } catch (e) {
        // ignore if path length cannot be computed
      }
    });

    const onEnd = (e: AnimationEvent) => {
      if (e.animationName === 'drawSignature') {
        svg.classList.add('reveal-logo');
        document.body.classList.add('logo-revealed');
      }
    };

    // Listen on the main path if available, otherwise on the group
    const target: Element | null = path ?? svg.querySelector('.signature-path');
    target?.addEventListener('animationend', onEnd as any);

    return () => {
      target?.removeEventListener('animationend', onEnd as any);
    };
  }, []);

  return (
    <div className="relative w-full h-[600px]">
      <svg
        ref={svgRef}
        viewBox="0 0 1024 880"
        preserveAspectRatio="xMidYMid meet"
        className="w-full h-full"
        style={{ ["--signature" as any]: "44 51% 67%", ["--draw-duration" as any]: "4.3s" }}
      >
        {/* Logo inside the same SVG for perfect 1:1 sizing with the drawing */}
        <image
          href="/logo.png"
          x="120"
          y="104"
          width="784"
          height="673"
          preserveAspectRatio="xMidYMid meet"
          className="pointer-events-none logo-fade"
        />

        {/* Signature strokes (drawn), fading out as the logo fades in */}
        <g
          className="strokes-crossfade"
          style={{ mixBlendMode: "screen" }}
        >
          {/* Subtle outer glow */}
          <path
            className="signature-glow"
            d="M242.894135,652.042969 
              C256.770111,608.359314 269.993622,564.911926 281.274933,520.869080 
              C286.084167,502.093628 283.975708,485.073669 273.766998,468.721466 
              C265.009308,454.693390 257.734253,439.911163 252.657425,424.109070 
              C245.053619,400.441467 243.400574,376.249908 245.447632,351.570374 
              C253.045975,259.963898 321.728180,169.537079 413.777252,133.611969 
              C441.574158,122.763329 470.086365,115.151527 499.749481,112.337318 
              C559.046875,106.711639 616.479126,112.899132 670.260010,140.702316 
              C700.100403,156.128952 726.563049,176.236343 750.933105,199.196793 
              C756.919250,204.836624 756.984436,210.041367 751.591980,216.253464 
              C727.736267,243.734985 702.328430,269.625183 673.646973,292.151978 
              C672.992004,292.666382 672.312256,293.151947 671.682983,293.695953 
              C659.755615,304.007294 647.360840,306.786743 632.217407,299.472137 
              C614.091797,290.717072 595.001221,283.925812 575.123840,280.069916 
              C526.159973,270.571716 480.060120,277.107056 439.379517,307.473694 
              C412.410309,327.605225 393.110199,353.859680 384.224335,386.845490 
              C378.438751,408.322479 380.383362,429.679413 386.272705,450.878418 
              C390.096283,464.641663 394.794037,478.151855 396.532471,492.487183 
              C399.776367,519.237244 394.472748,544.084839 381.391754,567.482727 
              C377.500916,574.442261 372.569916,580.735168 368.485626,587.317566 
              C370.064240,590.213196 372.436615,589.631531 374.497650,589.744019 
              C405.887695,591.457581 433.034607,581.098755 456.699249,560.823914 
              C475.518066,544.700806 487.772125,524.891602 490.435852,499.898682 
              C491.282623,491.953918 490.864349,483.918549 490.381073,475.928406 
              C490.350983,475.430969 490.190002,474.938446 490.185822,474.442841 
              C490.069061,460.571747 491.924316,454.201263 506.856995,451.276093 
              C534.263428,445.907471 560.828857,438.048004 585.726196,425.068573 
              C618.061035,408.211884 645.119568,384.756317 670.146790,358.596802 
              C691.053833,336.743774 709.307556,312.760468 727.529968,288.728394 
              C728.134094,287.931671 728.752380,287.145660 729.353455,286.346649 
              C731.144775,283.965332 733.230774,282.118439 736.503479,282.830902 
              C739.911987,283.572906 740.711731,286.425995 741.154480,289.243683 
              C742.315796,296.633911 743.282410,304.054840 744.324890,311.463745 
              C748.215393,339.114197 752.194519,366.752563 755.968506,394.418945 
              C759.226013,418.299103 762.274414,442.207947 765.368469,466.110168 
              C767.438171,482.099304 769.402954,498.102020 771.472046,514.091248 
              C771.833679,516.885498 771.928894,519.509399 769.060913,521.063232 
              C765.957703,522.744446 763.653137,521.068909 761.521545,519.007324 
              C753.809692,511.549011 747.510864,502.945343 741.538879,494.099274 
              C733.893921,482.775085 726.258911,471.426147 719.639648,459.466736 
              C714.426270,450.047302 706.393921,446.015930 696.014099,445.246521 
              C689.390991,444.755615 682.798218,443.707214 676.229736,442.669067 
              C670.196655,441.715424 664.786072,442.410889 659.756653,446.337555 
              C650.898315,453.253693 643.072876,461.141144 636.128906,469.939972 
              C635.306091,470.982605 634.495056,472.059631 634.504883,474.129303 
              C639.550781,476.703156 645.460266,476.523102 651.016174,477.624725 
              C660.148499,479.435394 669.368164,480.802155 678.512817,482.555084 
              C686.974487,484.177063 693.369202,488.970123 698.161316,496.046814 
              C707.332397,509.590271 717.058716,522.786865 728.557068,534.387268 
              C738.080200,543.994873 739.660645,555.047302 737.977539,567.489380 
              C735.123962,588.584778 732.321838,609.671082 731.191467,630.972961 
              C729.958130,654.214478 719.277771,672.528687 700.426208,686.142700 
              C694.142639,690.680359 687.315979,691.423889 679.983887,689.606506 
              C660.294617,684.725952 641.954041,676.427551 623.824402,667.569824 
              C593.351746,652.681396 565.216614,633.873657 536.674744,615.741089 
              C530.952026,612.105408 525.260254,608.365723 518.909241,605.558838 
              C516.143494,609.749146 518.056702,613.753052 518.700256,617.457214 
              C523.976868,647.830688 541.753845,668.691895 568.587341,682.757080 
              C595.142151,696.676147 623.414185,706.037720 651.877197,714.973755 
              C669.508911,720.509216 687.294922,725.584595 704.589417,732.146790 
              C722.243286,738.845459 736.652954,749.673584 746.785645,765.820557"
          />

          {/* Medium glow layer */}
          <path
            className="signature-medium"
            d="M242.894135,652.042969 
              C256.770111,608.359314 269.993622,564.911926 281.274933,520.869080 
              C286.084167,502.093628 283.975708,485.073669 273.766998,468.721466 
              C265.009308,454.693390 257.734253,439.911163 252.657425,424.109070 
              C245.053619,400.441467 243.400574,376.249908 245.447632,351.570374 
              C253.045975,259.963898 321.728180,169.537079 413.777252,133.611969 
              C441.574158,122.763329 470.086365,115.151527 499.749481,112.337318 
              C559.046875,106.711639 616.479126,112.899132 670.260010,140.702316 
              C700.100403,156.128952 726.563049,176.236343 750.933105,199.196793 
              C756.919250,204.836624 756.984436,210.041367 751.591980,216.253464 
              C727.736267,243.734985 702.328430,269.625183 673.646973,292.151978 
              C672.992004,292.666382 672.312256,293.151947 671.682983,293.695953 
              C659.755615,304.007294 647.360840,306.786743 632.217407,299.472137 
              C614.091797,290.717072 595.001221,283.925812 575.123840,280.069916 
              C526.159973,270.571716 480.060120,277.107056 439.379517,307.473694 
              C412.410309,327.605225 393.110199,353.859680 384.224335,386.845490 
              C378.438751,408.322479 380.383362,429.679413 386.272705,450.878418 
              C390.096283,464.641663 394.794037,478.151855 396.532471,492.487183 
              C399.776367,519.237244 394.472748,544.084839 381.391754,567.482727 
              C377.500916,574.442261 372.569916,580.735168 368.485626,587.317566 
              C370.064240,590.213196 372.436615,589.631531 374.497650,589.744019 
              C405.887695,591.457581 433.034607,581.098755 456.699249,560.823914 
              C475.518066,544.700806 487.772125,524.891602 490.435852,499.898682 
              C491.282623,491.953918 490.864349,483.918549 490.381073,475.928406 
              C490.350983,475.430969 490.190002,474.938446 490.185822,474.442841 
              C490.069061,460.571747 491.924316,454.201263 506.856995,451.276093 
              C534.263428,445.907471 560.828857,438.048004 585.726196,425.068573 
              C618.061035,408.211884 645.119568,384.756317 670.146790,358.596802 
              C691.053833,336.743774 709.307556,312.760468 727.529968,288.728394 
              C728.134094,287.931671 728.752380,287.145660 729.353455,286.346649 
              C731.144775,283.965332 733.230774,282.118439 736.503479,282.830902 
              C739.911987,283.572906 740.711731,286.425995 741.154480,289.243683 
              C742.315796,296.633911 743.282410,304.054840 744.324890,311.463745 
              C748.215393,339.114197 752.194519,366.752563 755.968506,394.418945 
              C759.226013,418.299103 762.274414,442.207947 765.368469,466.110168 
              C767.438171,482.099304 769.402954,498.102020 771.472046,514.091248 
              C771.833679,516.885498 771.928894,519.509399 769.060913,521.063232 
              C765.957703,522.744446 763.653137,521.068909 761.521545,519.007324 
              C753.809692,511.549011 747.510864,502.945343 741.538879,494.099274 
              C733.893921,482.775085 726.258911,471.426147 719.639648,459.466736 
              C714.426270,450.047302 706.393921,446.015930 696.014099,445.246521 
              C689.390991,444.755615 682.798218,443.707214 676.229736,442.669067 
              C670.196655,441.715424 664.786072,442.410889 659.756653,446.337555 
              C650.898315,453.253693 643.072876,461.141144 636.128906,469.939972 
              C635.306091,470.982605 634.495056,472.059631 634.504883,474.129303 
              C639.550781,476.703156 645.460266,476.523102 651.016174,477.624725 
              C660.148499,479.435394 669.368164,480.802155 678.512817,482.555084 
              C686.974487,484.177063 693.369202,488.970123 698.161316,496.046814 
              C707.332397,509.590271 717.058716,522.786865 728.557068,534.387268 
              C738.080200,543.994873 739.660645,555.047302 737.977539,567.489380 
              C735.123962,588.584778 732.321838,609.671082 731.191467,630.972961 
              C729.958130,654.214478 719.277771,672.528687 700.426208,686.142700 
              C694.142639,690.680359 687.315979,691.423889 679.983887,689.606506 
              C660.294617,684.725952 641.954041,676.427551 623.824402,667.569824 
              C593.351746,652.681396 565.216614,633.873657 536.674744,615.741089 
              C530.952026,612.105408 525.260254,608.365723 518.909241,605.558838 
              C516.143494,609.749146 518.056702,613.753052 518.700256,617.457214 
              C523.976868,647.830688 541.753845,668.691895 568.587341,682.757080 
              C595.142151,696.676147 623.414185,706.037720 651.877197,714.973755 
              C669.508911,720.509216 687.294922,725.584595 704.589417,732.146790 
              C722.243286,738.845459 736.652954,749.673584 746.785645,765.820557"
          />

          {/* Main signature path */}
          <path
            ref={pathRef}
            className="signature-path"
            d="M242.894135,652.042969 
              C256.770111,608.359314 269.993622,564.911926 281.274933,520.869080 
              C286.084167,502.093628 283.975708,485.073669 273.766998,468.721466 
              C265.009308,454.693390 257.734253,439.911163 252.657425,424.109070 
              C245.053619,400.441467 243.400574,376.249908 245.447632,351.570374 
              C253.045975,259.963898 321.728180,169.537079 413.777252,133.611969 
              C441.574158,122.763329 470.086365,115.151527 499.749481,112.337318 
              C559.046875,106.711639 616.479126,112.899132 670.260010,140.702316 
              C700.100403,156.128952 726.563049,176.236343 750.933105,199.196793 
              C756.919250,204.836624 756.984436,210.041367 751.591980,216.253464 
              C727.736267,243.734985 702.328430,269.625183 673.646973,292.151978 
              C672.992004,292.666382 672.312256,293.151947 671.682983,293.695953 
              C659.755615,304.007294 647.360840,306.786743 632.217407,299.472137 
              C614.091797,290.717072 595.001221,283.925812 575.123840,280.069916 
              C526.159973,270.571716 480.060120,277.107056 439.379517,307.473694 
              C412.410309,327.605225 393.110199,353.859680 384.224335,386.845490 
              C378.438751,408.322479 380.383362,429.679413 386.272705,450.878418 
              C390.096283,464.641663 394.794037,478.151855 396.532471,492.487183 
              C399.776367,519.237244 394.472748,544.084839 381.391754,567.482727 
              C377.500916,574.442261 372.569916,580.735168 368.485626,587.317566 
              C370.064240,590.213196 372.436615,589.631531 374.497650,589.744019 
              C405.887695,591.457581 433.034607,581.098755 456.699249,560.823914 
              C475.518066,544.700806 487.772125,524.891602 490.435852,499.898682 
              C491.282623,491.953918 490.864349,483.918549 490.381073,475.928406 
              C490.350983,475.430969 490.190002,474.938446 490.185822,474.442841 
              C490.069061,460.571747 491.924316,454.201263 506.856995,451.276093 
              C534.263428,445.907471 560.828857,438.048004 585.726196,425.068573 
              C618.061035,408.211884 645.119568,384.756317 670.146790,358.596802 
              C691.053833,336.743774 709.307556,312.760468 727.529968,288.728394 
              C728.134094,287.931671 728.752380,287.145660 729.353455,286.346649 
              C731.144775,283.965332 733.230774,282.118439 736.503479,282.830902 
              C739.911987,283.572906 740.711731,286.425995 741.154480,289.243683 
              C742.315796,296.633911 743.282410,304.054840 744.324890,311.463745 
              C748.215393,339.114197 752.194519,366.752563 755.968506,394.418945 
              C759.226013,418.299103 762.274414,442.207947 765.368469,466.110168 
              C767.438171,482.099304 769.402954,498.102020 771.472046,514.091248 
              C771.833679,516.885498 771.928894,519.509399 769.060913,521.063232 
              C765.957703,522.744446 763.653137,521.068909 761.521545,519.007324 
              C753.809692,511.549011 747.510864,502.945343 741.538879,494.099274 
              C733.893921,482.775085 726.258911,471.426147 719.639648,459.466736 
              C714.426270,450.047302 706.393921,446.015930 696.014099,445.246521 
              C689.390991,444.755615 682.798218,443.707214 676.229736,442.669067 
              C670.196655,441.715424 664.786072,442.410889 659.756653,446.337555 
              C650.898315,453.253693 643.072876,461.141144 636.128906,469.939972 
              C635.306091,470.982605 634.495056,472.059631 634.504883,474.129303 
              C639.550781,476.703156 645.460266,476.523102 651.016174,477.624725 
              C660.148499,479.435394 669.368164,480.802155 678.512817,482.555084 
              C686.974487,484.177063 693.369202,488.970123 698.161316,496.046814 
              C707.332397,509.590271 717.058716,522.786865 728.557068,534.387268 
              C738.080200,543.994873 739.660645,555.047302 737.977539,567.489380 
              C735.123962,588.584778 732.321838,609.671082 731.191467,630.972961 
              C729.958130,654.214478 719.277771,672.528687 700.426208,686.142700 
              C694.142639,690.680359 687.315979,691.423889 679.983887,689.606506 
              C660.294617,684.725952 641.954041,676.427551 623.824402,667.569824 
              C593.351746,652.681396 565.216614,633.873657 536.674744,615.741089 
              C530.952026,612.105408 525.260254,608.365723 518.909241,605.558838 
              C516.143494,609.749146 518.056702,613.753052 518.700256,617.457214 
              C523.976868,647.830688 541.753845,668.691895 568.587341,682.757080 
              C595.142151,696.676147 623.414185,706.037720 651.877197,714.973755 
              C669.508911,720.509216 687.294922,725.584595 704.589417,732.146790 
              C722.243286,738.845459 736.652954,749.673584 746.785645,765.820557"
            
          />
        </g>

        <style>{`
          .signature-glow {
            fill: none;
            stroke: hsl(var(--signature));
            stroke-width: 12;
            stroke-linecap: round;
            stroke-linejoin: round;
            stroke-dasharray: 6000;
            stroke-dashoffset: 6000;
            opacity: 0.15;
            filter: blur(8px);
            animation: drawSignature var(--draw-duration) cubic-bezier(0.32, 0.02, 0.2, 1) forwards, glowPulse var(--draw-duration) ease-in-out forwards;
          }
          .signature-medium {
            fill: none;
            stroke: hsl(var(--signature));
            stroke-width: 6;
            stroke-linecap: round;
            stroke-linejoin: round;
            stroke-dasharray: 6000;
            stroke-dashoffset: 6000;
            opacity: 0.4;
            filter: blur(2px);
            animation: drawSignature var(--draw-duration) cubic-bezier(0.32, 0.02, 0.2, 1) forwards, glowPulse var(--draw-duration) ease-in-out forwards;
          }
          .signature-path {
            fill: none;
            stroke: hsl(var(--signature));
            stroke-width: 3;
            stroke-linecap: round;
            stroke-linejoin: round;
            stroke-dasharray: 6000;
            stroke-dashoffset: 6000;
            filter: drop-shadow(0 0 3px hsl(var(--signature) / 0.5));
            animation: drawSignature var(--draw-duration) cubic-bezier(0.32, 0.02, 0.2, 1) forwards, pressurePulse var(--draw-duration) ease-in-out forwards;
          }

          /* Crossfade is triggered by a class when drawing finishes */
          .logo-fade {
            opacity: 0;
          }
          .strokes-crossfade {
            opacity: 1;
          }
          .reveal-logo .logo-fade {
            animation: logoFadeIn var(--logo-fade-duration) ease-in-out forwards;
          }
          .reveal-logo .strokes-crossfade {
            animation: strokesFadeOut var(--logo-fade-duration) ease-in-out forwards;
          }

          @keyframes drawSignature {
            to { stroke-dashoffset: 0; }
          }
          @keyframes logoFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
          }
          @keyframes strokesFadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
          }

          @keyframes pressurePulse {
            0% { stroke-width: 2.8; }
            8% { stroke-width: 3.3; }
            15% { stroke-width: 3.0; }
            28% { stroke-width: 3.4; }
            45% { stroke-width: 3.0; }
            60% { stroke-width: 3.3; }
            78% { stroke-width: 2.9; }
            100% { stroke-width: 3.0; }
          }

          @keyframes glowPulse {
            0% { opacity: 0.12; }
            20% { opacity: 0.18; }
            50% { opacity: 0.22; }
            80% { opacity: 0.16; }
            100% { opacity: 0.15; }
          }

          /* Mobile performance tweaks */
          @media (max-width: 1023px) {
            .signature-glow { stroke-width: 8; filter: blur(4px); }
            .signature-medium { stroke-width: 4; filter: blur(1px); opacity: 0.35; }
            .signature-path { stroke-width: 2; filter: drop-shadow(0 0 2px hsl(var(--signature) / 0.4)); }
          }

          /* Accessibility: reduced motion */
          @media (prefers-reduced-motion: reduce) {
            .signature-glow, .signature-medium, .signature-path {
              animation: none !important;
              stroke-dasharray: 0 !important;
              stroke-dashoffset: 0 !important;
            }
            .logo-fade { opacity: 1; }
            .strokes-crossfade { opacity: 0; }
          }
        `}</style>
      </svg>
    </div>
  );
};
